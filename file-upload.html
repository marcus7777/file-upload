<link rel="import" href="../polymer/polymer.html">
<!--
  `<file-upload></file-upload>` upload files to firebase
  @demo demo.html
-->
<dom-module id="file-upload">
  <template>
    <style>
      :host {display:inline-block}
    </style>
    <input type="file" id="files" name="files[]" multiple />
  </template>
</dom-module>
<script>
  Polymer({
    is: "file-upload",
    properties:{
      url:{
        type:String,
        notify:true,
      },
    },
    ready: function(){
      var that = this
      function handleFileSelect(evt) {
        var files = evt.target.files
        var uid = that.uid || "anyone"
        for (var i = 0, f; f = files[i]; i++) {
          firebase.storage().ref().child(uid + "/" + f.name).put(f).then(function(snapshot) {
            this.url = snapshot.downloadURL
            console.log('Uploaded a blob or file!', snapshot)
          }).catch(function(e) {
            if (e.code == "storage/unauthorized") {
              alert("unauthorized upload")
            }
            console.log(e)
          })
        }
      }
      this.$$("#files").addEventListener('change', handleFileSelect, false)
    },
  })
</script>
